# Claude Code Style Guide

## Python 환경 설정

### Python 버전
- **기본 Python 버전**: 3.10
- 모든 코드는 Python 3.10 호환성을 유지해야 합니다

### 개발 환경
로컬 테스트 시 **conda의 comm 환경**을 사용합니다:

```bash
# conda 환경 활성화
conda activate comm

# 패키지 설치
pip install -r data_scraper/requirements.txt

# Playwright 브라우저 설치
playwright install chromium
```

### 환경 확인
```bash
# Python 버전 확인
python --version  # Python 3.10.x 여야 함

# conda 환경 확인
conda info --envs
```

## Python Code Formatting

### Formatters

모든 Python 코드는 **Black formatter**와 **isort**를 사용해야 합니다.

#### Black 규칙:
1. **줄 길이**: 최대 88자
2. **문자열 따옴표**: 일관되게 큰따옴표(") 사용 (작은따옴표 가능하지만 큰따옴표 선호)
3. **들여쓰기**: 4 spaces
4. **함수/클래스 간격**:
   - Top-level 함수/클래스 사이: 2줄 공백
   - 클래스 내 메서드 사이: 1줄 공백
5. **import 정렬**: isort 사용 (아래 참조)

#### 예제:

```python
# Good (Black style)
from typing import Dict, List, Optional

from playwright.sync_api import sync_playwright, Browser

from ..utils.logger import setup_logger
from ..utils.config import Config


class ProductScraper:
    """상품 스크래퍼"""

    def __init__(self, headless: bool = True):
        """초기화"""
        self.headless = headless
        self.browser: Optional[Browser] = None

    def scrape_product(
        self,
        product_id: str,
        download_images: bool = True,
    ) -> Optional[Dict]:
        """상품 정보 스크래핑"""
        url = f"{Config.BASE_URL}/products/{product_id}"

        try:
            self.page.goto(url, wait_until="networkidle")
            return self._extract_data()
        except Exception as e:
            logger.error(f"스크래핑 실패: {e}")
            return None
```

#### isort 규칙:
**import 문은 항상 isort로 정렬해야 합니다.**

1. **정렬 순서**:
   - 표준 라이브러리 (Python built-in)
   - 서드파티 라이브러리 (pip로 설치한 패키지)
   - 로컬 애플리케이션 (상대 import)
   - 각 그룹 사이 1줄 공백

2. **isort 프로필**: black (Black과 호환)

3. **예제**:
```python
# Good (isort + black style)
import json
import time
from pathlib import Path
from typing import Dict, List, Optional

from playwright.sync_api import Browser, Page, sync_playwright
from bs4 import BeautifulSoup

from ..utils.config import Config
from ..utils.logger import setup_logger
```

### 자동 포매팅

코드 작성 후 자동으로 포매팅 적용:

```bash
# Black & isort 설치
pip install black isort

# isort로 import 정렬
isort data_scraper/

# Black으로 코드 포매팅
black data_scraper/

# 확인만 하기 (수정하지 않음)
isort --check data_scraper/
black --check data_scraper/

# 한 번에 실행
isort data_scraper/ && black data_scraper/
```

## 주요 코딩 규칙

### 1. Type Hints 사용 (필수)

**모든 함수와 메서드에 타입 힌트를 작성해야 합니다.**

#### 규칙:
1. **함수 매개변수**: 모든 매개변수에 타입 명시
2. **반환 타입**: 모든 함수의 반환 타입 명시
3. **변수 타입**: 복잡한 타입의 경우 변수에도 타입 힌트 사용
4. **typing 모듈**: `Optional`, `List`, `Dict`, `Union` 등 적극 활용

#### 예제:
```python
from typing import Dict, List, Optional, Union

# Good - 타입 힌트 사용
def scrape_product(
    self,
    product_id: str,
    download_images: bool = True
) -> Optional[Dict[str, Union[str, int, List[str]]]]:
    """상품 정보 스크래핑"""
    pass

def process_items(items: List[Dict[str, str]]) -> int:
    """아이템 처리"""
    return len(items)

# 변수 타입 힌트
browser: Optional[Browser] = None
product_data: Dict[str, str] = {}
image_urls: List[str] = []

# Bad - 타입 힌트 없음 (사용 금지)
def scrape_product(self, product_id, download_images=True):
    pass
```

#### None 반환 처리:
```python
# None을 반환할 수 있는 경우 Optional 사용
def find_element(selector: str) -> Optional[str]:
    element = page.query_selector(selector)
    return element.text if element else None
```

### 2. Docstring
모든 클래스와 public 메서드에 docstring을 작성하세요:
```python
def scrape_product(self, product_id: str) -> Optional[Dict]:
    """
    상품 상세 정보 스크래핑

    Args:
        product_id: 상품 ID

    Returns:
        상품 정보 딕셔너리 또는 None
    """
```

### 3. 명명 규칙
- 클래스: PascalCase (`ProductScraper`)
- 함수/변수: snake_case (`scrape_product`)
- 상수: UPPER_SNAKE_CASE (`MAX_PRODUCTS`)
- Private 메서드: `_method_name`

### 4. 에러 처리
구체적인 예외를 사용하고 적절히 로깅하세요:
```python
try:
    result = self.scrape_product(product_id)
except TimeoutError as e:
    logger.error(f"타임아웃: {e}")
except Exception as e:
    logger.error(f"예상치 못한 오류: {e}")
```

## 프로젝트 구조

새로운 모듈을 추가할 때:
```
data_scraper/
├── scrapers/       # 크롤링 로직
├── utils/          # 유틸리티 (config, logger, etc)
├── processors/     # 데이터 처리
└── exporters/      # 데이터 내보내기
```

## 커밋 메시지

```
<type>: <subject>

<body>

<footer>
```

Types:
- `feat`: 새로운 기능
- `fix`: 버그 수정
- `refactor`: 리팩토링
- `docs`: 문서 수정
- `style`: 코드 포맷팅
- `test`: 테스트 추가
- `chore`: 빌드/설정 변경
